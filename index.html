<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Quiz SCORM avec gestion API manquante</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 50px; text-align: center; }
        .question { font-size: 20px; margin-bottom: 30px; }
        .choice { margin: 10px; display: block; padding: 10px 20px; font-size: 16px; cursor: pointer; }
        .warning { color: orange; font-weight: bold; margin-bottom: 30px; }
    </style>
</head>
<body>

    <div id="warning" class="warning" style="display:none;">
        ⚠️ Avertissement : API SCORM non trouvée. Aucune progression ne sera sauvegardée.
    </div>

    <div id="quiz" style="display:none;">
        <div class="question">Quel est le plus grand océan du monde ?</div>
        <button class="choice" onclick="submitAnswer('Pacifique')">Pacifique</button>
        <button class="choice" onclick="submitAnswer('Atlantique')">Atlantique</button>
        <button class="choice" onclick="submitAnswer('Indien')">Indien</button>
        <button class="choice" onclick="submitAnswer('Arctique')">Arctique</button>
    </div>

    <h1 id="message" style="display:none;">Merci pour votre réponse !</h1>

    <script type="text/javascript">
        var API = null;
        var scormAvailable = false;

        // Cherche l'objet API SCORM dans la hiérarchie des fenêtres
        function findAPI(win) {
            while ((win.API == null) && (win.parent != null) && (win.parent != win)) {
                win = win.parent;
            }
            return win.API;
        }

        // Initialise la session SCORM
        function initializeSCORM() {
            API = findAPI(window);
            if (API != null) {
                if (API.LMSInitialize("")) {
                    scormAvailable = true;
                    console.log("SCORM Initialisé avec succès.");
                } else {
                    console.warn("LMSInitialize a échoué.");
                }
            } else {
                console.warn("API SCORM non trouvée !");
                document.getElementById('warning').style.display = "block";
            }
            document.getElementById('quiz').style.display = "block"; // Toujours afficher le quiz
        }

        // Envoie la réponse et termine la session
        function submitAnswer(answer) {
            console.log("Réponse choisie :", answer);
            if (scormAvailable) {
                API.LMSSetValue("cmi.core.lesson_status", "completed");
                API.LMSCommit("");
                API.LMSFinish("");
                console.log("SCORM terminé et complété.");
            } else {
                console.log("Pas d'API SCORM disponible. Progression non sauvegardée.");
            }
            document.getElementById('quiz').style.display = "none";
            document.getElementById('message').style.display = "block";
        }

        // Quand la page est chargée
        window.onload = initializeSCORM;
    </script>

</body>
</html>
